<header>
    <div class="header">
        <!-- Logo -->
        <div class="logo">
            <a href="index.html">
                <img src="images/logo2.svg" alt="KickStar" width="70px" title="KickStar Home">
            </a>
        </div>

        <!-- Desktop Search -->
        <div class="search-bar desktop">
            <form action="pages/search.html" method="get">
                <input type="search" placeholder="Search Products, Categories, Brands..." name="q" class="search-input"
                    required>
                <i class="ri-search-line"></i>
                <input type="submit" value="Search" class="search-btn">
            </form>
        </div>

        <!-- Header Items -->
        <div class="header-items">
            <!-- Mobile Search Toggle -->
            <div class="search-toggle mobile-only">
                <i class="ri-search-line" title="Search"></i>
            </div>

            <div class="help">
                <i class="ri-questionnaire-line"></i>
            </div>

            <div class="account">
                <i class="ri-account-circle-line" title="Account"></i>
                <div class="account-dropdown">
                    <p class="login"><a href="#">Login</a></p>
                    <p class="register"><a href="#">Register</a></p>
                </div>
            </div>

            <div class="cart">
                <a href="pages/cart.html">
                    <i class="ri-shopping-cart-line" title="Cart"></i>
                    <span id="cart-count" class="cart-count">0</span>
                </a>
            </div>

            <!-- <div class="nav-toggle mobile-only">
                        <i class="ri-menu-line" title="Open Menu"></i>
                    </div> -->
        </div>
    </div>

    <!-- Mobile Search -->
    <div class="search-bar mobile">
        <form action="pages/search.html" method="get">
            <input type="search" class="search-input" placeholder="Search Products, Categories, Brands..." name="q"
                required>
            <i class="ri-search-line"></i>
        </form>
    </div>

    <!-- Navigation -->
    <nav>
        <ul class="nav-links">
            <li><a href="index.html" class="active-url" title="Home">Home</a></li>
            <li><a href="pages/category.html?cat=all" title="All Products">All</a></li>
            <li><a href="pages/category.html?cat=featured" title="Featured Products">Featured</a></li>
            <li><a href="pages/category.html?cat=women" title="Women's Shoes">Women</a></li>
            <li><a href="pages/category.html?cat=men" title="Men's Shoes">Men</a></li>
            <li><a href="pages/category.html?cat=kids" title="Kids Shoes">Kids</a></li>
            <li><a href="pages/category.html?cat=unisex" title="Unisex Shoes">Unisex</a></li>
            <li><a href="pages/category.html?cat=new" title="New in Store">New</a></li>
            <li><a href="pages/category.html?cat=deals" title="Deals">Deals</a></li>
            <li><a href="pages/brands.html" title="Brands">Brands</a></li>
        </ul>
    </nav>
</header>

<div class="header-after"></div>


<script>
    document.addEventListener("DOMContentLoaded", () => {
        const headerPlaceholder = document.getElementById("header");

        if (headerPlaceholder) {
            fetch("include/header.html")
                .then(res => res.text())
                .then(data => {
                    document.getElementById("header").innerHTML = data;
                })
                .then(() => {

                    // === Path fixer ===
                    const isInPages = window.location.pathname.includes("/pages/");

                    // Fix logo path
                    const logo = headerPlaceholder.querySelector(".logo a");
                    if (logo) logo.setAttribute("href", isInPages ? "../index.html" : "index.html");

                    // Fix logo image
                    const logoImg = headerPlaceholder.querySelector(".logo img");
                    if (logoImg) logoImg.setAttribute("src", isInPages ? "../images/logo2.svg" : "images/logo2.svg");

                    // Fix search form action
                    headerPlaceholder.querySelectorAll("form[action*='search.html']").forEach(form => {
                        form.setAttribute("action", isInPages ? "search.html" : "pages/search.html");
                    });

                    // Fix cart link
                    const cartLink = headerPlaceholder.querySelector(".cart a");
                    if (cartLink) cartLink.setAttribute("href", isInPages ? "cart.html" : "pages/cart.html");

                    // Fix category links
                    headerPlaceholder.querySelectorAll(".nav-links a[href*='category.html']").forEach(link => {
                        if (isInPages) {
                            link.setAttribute("href", link.getAttribute("href").replace("pages/", ""));
                        }
                    });

                    initHeader();
                });
        }
    });

    function initHeader() {
        const searchToggle = document.querySelector(".search-toggle"); // the button with icon
        const searchIcon = searchToggle?.querySelector("i"); // the <i> inside
        const mobileSearchBar = document.querySelector(".search-bar.mobile");
        const mobileSearchInput = mobileSearchBar?.querySelector("input[type=search]");

        if (searchToggle && mobileSearchBar && searchIcon) {
            searchToggle.addEventListener("click", (e) => {
                e.stopPropagation(); // prevent auto-close on same click
                mobileSearchBar.classList.toggle("active");

                if (mobileSearchBar.classList.contains("active")) {
                    // switch icon to close
                    searchIcon.classList.remove("ri-search-line");
                    searchIcon.classList.add("ri-close-line");

                    if (mobileSearchInput) {
                        setTimeout(() => mobileSearchInput.focus(), 300);
                    }
                } else {
                    // switch icon back to search
                    searchIcon.classList.remove("ri-close-line");
                    searchIcon.classList.add("ri-search-line");
                }
            });

            // Close search bar when clicking outside
            document.addEventListener("click", (event) => {
                if (
                    mobileSearchBar.classList.contains("active") &&
                    !mobileSearchBar.contains(event.target) &&
                    !searchToggle.contains(event.target)
                ) {
                    mobileSearchBar.classList.remove("active");
                    searchIcon.classList.remove("ri-close-line");
                    searchIcon.classList.add("ri-search-line");
                }
            });
        }
    };



    document.addEventListener("DOMContentLoaded", () => {
        const navLinks = document.querySelectorAll("header nav a");
        const depth = window.location.pathname.split("/").length - 2; // how deep the file is
        let prefix = "";

        for (let i = 0; i < depth; i++) {
            prefix += "../";
        }

        navLinks.forEach(link => {
            const href = link.getAttribute("data-href"); // store clean path in data-href
            if (href) {
                link.setAttribute("href", prefix + href);
            }
        });
    });




</script>