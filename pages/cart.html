<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shopping Cart - KickStar</title>
    <link rel="stylesheet" href="../css/index.css">
    <link rel="stylesheet" href="../css/header.css">
    <link rel="stylesheet" href="../css/footer.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/remixicon/4.6.0/remixicon.min.css">

    <style>
        .cart-container {
            padding: 1em 0;
            margin: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }

        th,
        td {
            padding: 12px;
            border-bottom: 1px solid #ddd;
            text-align: center;
        }

        th {
            background: #f5f5f5;
        }

        img {
            width: 60px;
            height: 60px;
            object-fit: cover;
            border-radius: 6px;
        }

        .qty-input {
            width: 60px;
            padding: 4px;
            text-align: center;
        }

        .remove-btn {
            background: red;
            color: white;
            border: none;
            padding: 6px 10px;
            border-radius: 4px;
            cursor: pointer;
        }

        .cart-total {
            text-align: right;
            font-size: 18px;
            margin-top: 10px;
        }

        .checkout-btn {
            background: var(--primary-color, #fd3008);
            color: white;
            padding: 10px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            float: right;
        }
    </style>
</head>

<body>
    <div class="container">
        <header>
            <div class="header">
                <div class="logo">
                    <a href="/index.html"><img src="/images/logo2.svg" alt="" width="70px" title="KickStar"></a>
                </div>

                <div class="search-bar desktop">

                    <form action="#" method="get">
                        <input type="search" placeholder="Search Products, Categories, Brands, ..." name="q" required>
                        <i class="ri-search-line"></i>
                        <input type="submit" value="Search">
                    </form>
                </div>

                <div class="header-items">
                    <div class="help">
                        <i class="ri-questionnaire-line"></i>
                    </div>

                    <div class="account">
                        <i class="ri-account-circle-line" title="Account"></i>
                        <div class="account-dropdown">
                            <p class="login"><a href="#">Login</a></p>
                            <p class="register"><a href="#">Register</a></p>
                        </div>
                    </div>

                    <div class="cart">
                        <a href="/pages/cart.html">
                            <i class="ri-shopping-cart-line" title="Cart"></i>
                            <span id="cart-count" class="cart-count">0</span>
                        </a>
                    </div>
                </div>
            </div>

            <div class="search-bar mobile">
                <form action="#" method="get">
                    <input type="search" placeholder="Search Products, Categories, Brands, ..." name="q" required>
                    <!-- <span><i class="ri-search-line"></i></span> -->
                    <input type="submit" value="Search">
                </form>
            </div>
            <nav>
                <ul class="nav-links">
                    <li><a href="#">All</a></li>
                    <li><a href="#">Women</a></li>
                    <li><a href="#">Men</a></li>
                    <li><a href="#">Kids</a></li>
                    <li><a href="#">New</a></li>
                    <li><a href="#">Deals</a></li>
                    <li><a href="#">Brands</a></li>
                    <li><a href="#">Sale</a></li>
                    <li><a href="#">Contact</a></li>
                    <li><a href="#">About</a></li>
                </ul>
            </nav>

        </header>

        <div class="header-after"></div>

        <div class="cart-container">
            <h2>Your Shopping Cart</h2>
            <table id="cart-table">
                <thead>
                    <tr>
                        <th>Product</th>
                        <th>Details</th>
                        <th>Price</th>
                        <th>Quantity</th>
                        <th>Subtotal</th>
                        <th>Remove</th>
                    </tr>
                </thead>
                <tbody id="cart-body"></tbody>
            </table>
            <div class="cart-total">
                <strong>Total: </strong>KES <span id="cart-total">0</span>
            </div>
            <br>
            <button class="checkout-btn">Proceed to Checkout</button>
        </div>

        <footer class="footer">
            <div class="container footer-content">
                <!-- Logo / Brand -->
                <div class="footer-brand">
                    <h2 class="logo">Kick<span>Star</span></h2>
                    <p>Your trusted shop for sneakers and lifestyle shoes.</p>
                    <div class="social-links">
                        <a href="#" aria-label="Facebook"><i class="fab fa-facebook-f"></i></a>
                        <a href="#" aria-label="Instagram"><i class="fab fa-instagram"></i></a>
                        <a href="#" aria-label="Twitter"><i class="fab fa-twitter"></i></a>
                        <a href="#" aria-label="YouTube"><i class="fab fa-youtube"></i></a>
                    </div>
                </div>

                <!-- Links -->
                <div class="footer-links">
                    <h3>Shop</h3>
                    <ul>
                        <li><a href="#">Men</a></li>
                        <li><a href="#">Women</a></li>
                        <li><a href="#">Kids</a></li>
                        <li><a href="#">New Arrivals</a></li>
                        <li><a href="#">Sale</a></li>
                    </ul>
                </div>

                <div class="footer-links">
                    <h3>Support</h3>
                    <ul>
                        <li><a href="#">Help Center</a></li>
                        <li><a href="#">Track Order</a></li>
                        <li><a href="#">Shipping & Returns</a></li>
                        <li><a href="#">Size Guide</a></li>
                        <li><a href="#">FAQs</a></li>
                    </ul>
                </div>

                <div class="footer-links">
                    <h3>Company</h3>
                    <ul>
                        <li><a href="#">About Us</a></li>
                        <li><a href="#">Sustainability</a></li>
                        <li><a href="#">Careers</a></li>
                        <li><a href="#">Press</a></li>
                        <li><a href="#">Contact</a></li>
                    </ul>
                </div>

                <!-- Newsletter -->
                <div class="footer-newsletter">
                    <h3>Stay Updated</h3>
                    <p>Subscribe for exclusive offers and new releases.</p>
                    <form>
                        <input type="email" placeholder="Enter your email" required>
                        <button type="submit">Subscribe</button>
                    </form>
                </div>
            </div>

            <!-- Bottom -->
            <div class="footer-bottom">
                <div class="container">
                    <p>&copy; 2025 Kickstar. All rights reserved.</p>
                </div>
            </div>
        </footer>

    <!-- âœ… Product Data -->
    <script src="../js/products.js"></script>

    <script>
        // --- Cart Utilities ---
        function getCart() { return JSON.parse(localStorage.getItem("cart") || "[]"); }
        function setCart(cart) { localStorage.setItem("cart", JSON.stringify(cart)); }
        function updateCartCount() {
            const cart = getCart();
            const count = cart.reduce((sum, item) => sum + item.qty, 0);
            document.getElementById("cart-count").textContent = count;
        }

        // --- Render Cart Page ---
        function renderCart() {
            const cart = getCart();
            const body = document.getElementById("cart-body");
            const totalEl = document.getElementById("cart-total");
            body.innerHTML = "";
            let total = 0;

            if (cart.length === 0) {
                body.innerHTML = `<tr><td colspan="6">Your cart is empty.</td></tr>`;
                totalEl.textContent = "0";
                return;
            }

            cart.forEach((item, index) => {
                // ðŸ”— Lookup actual stock from productsData
                let stock = 1;
                try {
                    const product = productsData[item.productIndex];
                    const variant = product.variants[item.variantIndex];
                    const sizeObj = variant.sizes[item.sizeIndex];
                    stock = sizeObj.stock_quantity;
                } catch (e) {
                    stock = 1; // fallback if data not found
                }

                // Clamp qty if above stock
                if (item.qty > stock) item.qty = stock;

                const subtotal = item.qty * item.price;
                total += subtotal;

                body.innerHTML += `
          <tr>
            <td><img src="${item.image}" alt="${item.name}"></td>
            <td>${item.name}<br><small>${item.color}, Size ${item.size}</small></td>
            <td>KES ${item.price}</td>
            <td>
              <input type="number" class="qty-input" min="1" max="${stock}" value="${item.qty}" data-index="${index}">
              ${stock === 0 ? "<br><small style='color:red;'>Out of Stock</small>" : ""}
            </td>
            <td>KES ${subtotal}</td>
            <td><button class="remove-btn" data-index="${index}">X</button></td>
          </tr>
        `;
            });

            totalEl.textContent = total;

            // Quantity change events
            document.querySelectorAll(".qty-input").forEach(input => {
                input.addEventListener("change", (e) => {
                    const index = e.target.dataset.index;
                    let cart = getCart();
                    let newQty = parseInt(e.target.value, 10);
                    const product = productsData[cart[index].productIndex];
                    const variant = product.variants[cart[index].variantIndex];
                    const sizeObj = variant.sizes[cart[index].sizeIndex];
                    const stock = sizeObj.stock_quantity;

                    if (newQty < 1) newQty = 1;
                    if (newQty > stock) newQty = stock;

                    cart[index].qty = newQty;
                    setCart(cart);
                    renderCart();
                    updateCartCount();
                });
            });

            // Remove item
            document.querySelectorAll(".remove-btn").forEach(btn => {
                btn.addEventListener("click", (e) => {
                    const index = e.target.dataset.index;
                    let cart = getCart();
                    cart.splice(index, 1);
                    setCart(cart);
                    renderCart();
                    updateCartCount();
                });
            });
        }

        // --- On Load ---
        updateCartCount();
        renderCart();
    </script>
</body>

</html>